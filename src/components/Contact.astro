---
import SectionHeader from "./ui/SectionHeader.astro";

const hours = [{ id: "tueFri" }, { id: "sat" }, { id: "sun" }, { id: "mon" }];
---

<section id="contatti" class="py-20 md:py-32 lg:py-40 bg-sand texture-overlay">
  <div class="max-w-7xl mx-auto px-6">
    <!-- Header -->
    <div class="mb-12 md:mb-20 reveal">
      <SectionHeader
        tagline="Vieni a Trovarci"
        taglineI18n="contact.tagline"
        title="Contatti"
        titleI18n="contact.title"
        align="center"
      />
    </div>

    <!-- Content -->
    <div
      class="flex flex-col md:flex-row items-center md:items-start text-center md:text-left justify-center gap-10 md:gap-16 lg:gap-24 reveal-stagger"
    >
      <!-- Address -->
      <div class="space-y-4 md:space-y-6">
        <svg
          class="w-6 h-6 text-gold mx-auto md:mx-0"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          ></path>
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
        <div>
          <h3
            class="text-[10px] md:text-xs tracking-[0.2em] md:tracking-[0.3em] uppercase text-charcoal mb-3 md:mb-4"
            data-i18n="contact.addressTitle"
          >
            Dove Siamo
          </h3>
          <div class="text-sm md:text-base text-charcoal-light space-y-1">
            <p data-i18n="contact.address1">Largo Castello</p>
            <p data-i18n="contact.address2">66026 Ortona (CH)</p>
          </div>
        </div>
        <a
          href="#"
          class="inline-flex items-center gap-2 text-xs md:text-sm text-amber hover:text-charcoal transition-colors group"
        >
          <span data-i18n="contact.openMaps">Apri in Maps</span>
          <svg
            class="w-3 h-3 group-hover:translate-x-1 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>

      <!-- Hours -->
      <div class="space-y-4 md:space-y-6">
        <svg
          class="w-6 h-6 text-gold mx-auto md:mx-0"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <h3
            class="text-[10px] md:text-xs tracking-[0.2em] md:tracking-[0.3em] uppercase text-charcoal mb-3 md:mb-4"
            data-i18n="contact.hoursTitle"
          >
            Orari
          </h3>
          <ul class="space-y-0.5 md:space-y-1">
            {
              hours.map((item) => (
                <li
                  class="text-sm md:text-base text-charcoal-light"
                  data-hour-id={item.id}
                >
                  <span
                    class="text-charcoal"
                    data-i18n={`contact.hours.${item.id}.day`}
                  />
                  <br class="md:hidden" />
                  <span
                    class="text-xs md:text-sm"
                    data-i18n={`contact.hours.${item.id}.time`}
                  />
                </li>
              ))
            }
          </ul>
        </div>
      </div>

      <!-- Contact -->
      <div class="space-y-4 md:space-y-6">
        <svg
          class="w-6 h-6 text-gold mx-auto md:mx-0"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
          ></path>
        </svg>
        <div>
          <h3
            class="text-[10px] md:text-xs tracking-[0.2em] md:tracking-[0.3em] uppercase text-charcoal mb-3 md:mb-4"
            data-i18n="contact.contactTitle"
          >
            Contattaci
          </h3>
          <div class="space-y-2 md:space-y-3 text-sm md:text-base">
            <a
              href="mailto:ciao@panima.it"
              class="block text-charcoal-light hover:text-amber transition-colors"
            >
              ciao@panima.it
            </a>
            <a
              href="#"
              class="block text-charcoal-light hover:text-amber transition-colors"
            >
              @panima_forno
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Map with hand-drawn frame -->
    <div class="mt-12 md:mt-20 reveal">
      <div class="w-full sm:max-w-md mx-auto relative">
        <!-- SVG clip path definition -->
        <svg class="absolute w-0 h-0">
          <defs>
            <clipPath id="hand-drawn-clip" clipPathUnits="objectBoundingBox">
              <path
                d="
                M 0.02 0.03
                Q 0.01 0.015, 0.05 0.02
                Q 0.15 0.01, 0.25 0.025
                Q 0.35 0.005, 0.45 0.02
                Q 0.55 0.01, 0.65 0.025
                Q 0.75 0.005, 0.85 0.02
                Q 0.95 0.01, 0.97 0.03
                Q 0.99 0.05, 0.98 0.15
                Q 0.995 0.25, 0.975 0.35
                Q 0.99 0.45, 0.98 0.55
                Q 0.995 0.65, 0.975 0.75
                Q 0.99 0.85, 0.97 0.95
                Q 0.96 0.99, 0.85 0.975
                Q 0.75 0.995, 0.65 0.98
                Q 0.55 0.99, 0.45 0.975
                Q 0.35 0.995, 0.25 0.98
                Q 0.15 0.99, 0.05 0.975
                Q 0.01 0.97, 0.02 0.85
                Q 0.005 0.75, 0.025 0.65
                Q 0.01 0.55, 0.02 0.45
                Q 0.005 0.35, 0.025 0.25
                Q 0.01 0.15, 0.02 0.03
                Z
              "
              ></path>
            </clipPath>
          </defs>
        </svg>

        <!-- Image with clip -->
        <div class="hand-drawn-frame">
          <img
            src="/map.webp"
            alt="Mappa di Panima"
            class="w-full"
            loading="lazy"
          />
        </div>

        <!-- Hand-drawn border overlay -->
        <svg
          class="absolute inset-0 w-full h-full pointer-events-none"
          viewBox="0 0 100 100"
          preserveAspectRatio="none"
        >
          <path
            d="
              M 2 3
              Q 1 1.5, 5 2
              Q 15 1, 25 2.5
              Q 35 0.5, 45 2
              Q 55 1, 65 2.5
              Q 75 0.5, 85 2
              Q 95 1, 97 3
              Q 99 5, 98 15
              Q 99.5 25, 97.5 35
              Q 99 45, 98 55
              Q 99.5 65, 97.5 75
              Q 99 85, 97 95
              Q 96 99, 85 97.5
              Q 75 99.5, 65 98
              Q 55 99, 45 97.5
              Q 35 99.5, 25 98
              Q 15 99, 5 97.5
              Q 1 97, 2 85
              Q 0.5 75, 2.5 65
              Q 1 55, 2 45
              Q 0.5 35, 2.5 25
              Q 1 15, 2 3
              Z
            "
            fill="none"
            stroke="#a87735"
            stroke-width="0.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="opacity-60"></path>
        </svg>
      </div>
    </div>
  </div>
</section>

<style>
  .hand-drawn-frame {
    clip-path: url(#hand-drawn-clip);
  }
</style>

<script>
  import { getStoredLanguage } from "../i18n/i18n";
  import { translations } from "../i18n/translations";

  function updateHours() {
    const lang = getStoredLanguage();
    const t = translations[lang];

    document.querySelectorAll("[data-hour-id]").forEach((el) => {
      const hourId = el.getAttribute(
        "data-hour-id"
      ) as keyof typeof t.contact.hours;
      if (hourId && t.contact.hours[hourId]) {
        const dayEl = el.querySelector('[data-i18n$=".day"]');
        const timeEl = el.querySelector('[data-i18n$=".time"]');

        if (dayEl) dayEl.textContent = t.contact.hours[hourId].day;
        if (timeEl) timeEl.textContent = t.contact.hours[hourId].time;
      }
    });
  }

  updateHours();
  document.addEventListener("DOMContentLoaded", updateHours);
  window.addEventListener("storage", (e) => {
    if (e.key === "panima-lang") updateHours();
  });
</script>
